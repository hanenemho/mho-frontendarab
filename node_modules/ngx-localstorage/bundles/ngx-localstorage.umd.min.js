!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-localstorage",["exports","@angular/core","rxjs","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-localstorage"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,(function(e,t,r,n){"use strict";var o=function(e,t,r,n){for(var o=e.length-1,i=0;i<o;++i){var a=e[i];a in r||(r[a]={}),r=r[a]}r[e[o]]=(!t||"string"==typeof t&&"false"===t)&&n?n():t},i=function(e,t,r){var n=t||r;return n?n+"_"+e:e},a={allowNull:!0},s=function(e){return!!e&&void 0!==e.serialize},l=function(){function e(e,t){this.configuration=e,this.defaultSerializer=t}return e.prototype.count=function(){return new Promise((function(e,t){try{e(localStorage.length)}catch(e){t(e)}}))},e.prototype.getKey=function(e){return new Promise((function(t,r){e<0&&r(new Error("index has to be 0 or greater"));try{t(localStorage.key(e))}catch(e){r(e)}}))},e.prototype.set=function(e,t,r,n){var o=this;return new Promise((function(a,l){try{var u="string"==typeof r?r:void 0;if(n=s(r)?r:n||o.defaultSerializer,!o.configuration.allowNull&&(o.configuration.allowNull||"null"===t||null==t))return o.remove(e,u);localStorage.setItem(i(e,u,o.configuration.prefix),n.serialize(t)),a(!0)}catch(e){l(e)}}))},e.prototype.get=function(e,t,r){var n=this;return new Promise((function(o,a){try{var l="string"==typeof t?t:void 0;o((r=s(t)?t:r||n.defaultSerializer).deserialize(localStorage.getItem(i(e,l,n.configuration.prefix))))}catch(e){a(e)}}))},e.prototype.remove=function(e,t){var r=this;return new Promise((function(n,o){try{localStorage.removeItem(i(e,t,r.configuration.prefix)),n(!0)}catch(e){o(e)}}))},e.prototype.clear=function(){return new Promise((function(e,t){try{localStorage.clear(),e(!0)}catch(e){t(e)}}))},e}(),u=new t.InjectionToken("NgxLocalstorageConfiguration"),c=new t.InjectionToken("StorageSerializer"),f=function(){function e(e,t){this.defaultSerializer=e,this.config=t,this.config=Object.assign(Object.assign({},a),t),this.promisable=new l(this.config,this.defaultSerializer)}return e.prototype.asPromisable=function(){return this.promisable},e.prototype.count=function(){try{return localStorage.length}catch(e){console.error(e)}},e.prototype.getKey=function(e){e<0&&console.error(new Error("index has to be 0 or greater"));try{return localStorage.key(e)}catch(e){console.error(e)}},e.prototype.set=function(e,t,r,n){var o="string"==typeof r?r:void 0;n=s(r)?r:n||this.defaultSerializer,this.config.allowNull||!this.config.allowNull&&"null"!==t&&null!=t?localStorage.setItem(i(e,o,this.config.prefix),n.serialize(t)):this.remove(e,i(e,o,this.config.prefix))},e.prototype.get=function(e,t,r){var n="string"==typeof t?t:void 0;r=s(t)?t:r||this.defaultSerializer;try{return r.deserialize(localStorage.getItem(i(e,n,this.config.prefix)))}catch(e){console.error(e)}},e.prototype.remove=function(e,t){try{localStorage.removeItem(i(e,t,this.config.prefix))}catch(e){console.error(e)}},e.prototype.clear=function(){try{localStorage.clear()}catch(e){console.error(e)}},e}();f.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new f(t.ɵɵinject(c),t.ɵɵinject(u))},token:f,providedIn:"root"}),f.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],f.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]},{type:void 0,decorators:[{type:t.Inject,args:[u]}]}]};var p=function(){function e(){var e=this;this._eventStream=new r.BehaviorSubject(null),this.subscription=r.fromEvent(window,"storage").subscribe((function(t){return e._eventStream.next(t)}))}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._eventStream.asObservable().pipe(n.filter((function(e){return!!e})),n.share())},enumerable:!1,configurable:!0}),e.prototype.ngOnDestroy=function(){this.subscription&&!this.subscription.closed&&this.subscription.unsubscribe()},e}();p.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new p},token:p,providedIn:"root"}),p.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],p.ctorParameters=function(){return[]};var h=function(){function e(e,r,i){var a=this;this.er=e,this.lss=r,this.es=i,this.lsDebounce=0,this.lsInitFromStorage=!1,this.lsStoredValue=new t.EventEmitter,this._valuePath=[],this.es.stream.pipe(n.filter((function(e){return e.key&&e.key.indexOf(a.lsKey)>=0}))).subscribe((function(e){o(a._valuePath.length?a._valuePath:["value"],e.newValue,a.er.nativeElement,a.lsFalsyTransformer)}))}return Object.defineProperty(e.prototype,"lsValuePath",{set:function(e){this._valuePath=null!=e?Array.isArray(e)?e:e.split(","):[]},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){this._initKey(),this._initFromStorage(),this._hookEvent()},e.prototype._initKey=function(){if(!this.lsKey){if(!this.er.nativeElement.id&&!this.er.nativeElement.name)throw new Error("No key or element id or name supplied!");this.lsKey=this.er.nativeElement.id||this.er.nativeElement.name}},e.prototype._hookEvent=function(){var e=this;this.lsEvent&&(this._eventSubscription=r.fromEvent(this.er.nativeElement,this.lsEvent).pipe(n.debounceTime(this.lsDebounce)).subscribe((function(){var t,r;e.lss.asPromisable().set(e.lsKey,(t=e._valuePath.length?e._valuePath:["value"],r=e.er.nativeElement,t.reduce((function(e,t){return e?e[t]:null}),r)),e.lsPrefix).then((function(){e.lss.asPromisable().get(e.lsKey,e.lsPrefix).then((function(t){e.lsStoredValue.emit(t)})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.error(e)}))})))},e.prototype._initFromStorage=function(){var e=this;this.lsInitFromStorage&&this.lss.asPromisable().get(this.lsKey,this.lsPrefix).then((function(t){o(e._valuePath.length?e._valuePath:["value"],t,e.er.nativeElement,e.lsFalsyTransformer)})).catch((function(e){return console.error(e)}))},e.prototype.ngOnDestroy=function(){this._eventSubscription&&!this._eventSubscription.closed&&this._eventSubscription.unsubscribe()},e}();h.decorators=[{type:t.Directive,args:[{selector:"[ngxLocalStorage]"}]}],h.ctorParameters=function(){return[{type:t.ElementRef},{type:f},{type:p}]},h.propDecorators={lsKey:[{type:t.Input,args:["ngxLocalStorage"]}],lsPrefix:[{type:t.Input}],lsEvent:[{type:t.Input}],lsDebounce:[{type:t.Input}],lsInitFromStorage:[{type:t.Input}],lsFalsyTransformer:[{type:t.Input}],lsValuePath:[{type:t.Input}],lsStoredValue:[{type:t.Output}]};var y=function(){function e(){}return e.prototype.serialize=function(e){return JSON.stringify(e)},e.prototype.deserialize=function(e){return JSON.parse(e)},e}();y.decorators=[{type:t.Injectable}];var g=function(){function e(e){if(e)throw new Error("NgxLocalStorageModule is already loaded. Import it in the AppModule only")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:u,useValue:t}]}},e}();g.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[h],exports:[h],providers:[{provide:c,useClass:y}]}]}],g.ctorParameters=function(){return[{type:g,decorators:[{type:t.Optional},{type:t.SkipSelf}]}]},e.LocalStorageDirective=h,e.LocalStorageService=f,e.NGX_LOCAL_STORAGE_CONFIG=u,e.NGX_LOCAL_STORAGE_SERIALIZER=c,e.NgxLocalStorageModule=g,e.StorageEventService=p,e.ngxLocalStorage=function(e){return function(t,r){var o=e&&e.key?e.key:r,a=e&&e.prefix?e.prefix:null,s=new f(new y,{prefix:a});(new p).stream.pipe(n.filter((function(e){return e.key&&e.key.indexOf(i(o,a))>=0}))).subscribe((function(n){n.newValue&&"string"==typeof n.newValue&&("null"!==n.newValue?t[r]=n.newValue:t[r]=e.nullTransformer?e.nullTransformer():null)})),Object.defineProperty(t,r,{get:function(){var t=s.get(o,a);return null==t&&e.nullTransformer?e.nullTransformer():t},set:function(e){s.set(o,e,a)}})}},e.ɵa=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-localstorage.umd.min.js.map