{"version":3,"file":"decorators.js","sourceRoot":"ng://ngx-localstorage/","sources":["lib/decorators.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,gBAAgB,CAAC;AAGxC,OAAO,EAAE,mBAAmB,EAAE,MAAM,qCAAqC,CAAC;AAC1E,OAAO,EAAE,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AACvE,OAAO,EAAE,YAAY,EAAE,MAAM,SAAS,CAAC;AACvC,OAAO,EAAE,iBAAiB,EAAE,MAAM,8BAA8B,CAAC;AAEjE;;;GAGG;AACH,MAAM,UAAU,eAAe,CAAC,OAAuB;IACrD,OAAO,UAAU,MAAc,EAAE,mBAA2B;QAE1D,IAAM,GAAG,GAAG,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,mBAAmB,CAAC;QAC3E,IAAM,MAAM,GAAG,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC;QAErE,IAAM,OAAO,GAAwB,IAAI,mBAAmB,CAAC,IAAI,iBAAiB,EAAE,EAClF;YACE,MAAM,EAAE,MAAM;SACf,CAAC,CAAC;QAGL,IAAM,YAAY,GAAwB,IAAI,mBAAmB,EAAE,CAAC;QACpE,YAAY,CAAC,MAAM,CAAC,IAAI;QACtB,uCAAuC;QACvC,MAAM,CAAC,UAAC,EAAgB,IAAK,OAAA,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,IAAI,CAAC,EAAxD,CAAwD,CAAC,CACvF;aACE,SAAS,CAAC,UAAC,EAAgB;YAC1B,IAAI,CAAC,CAAC,EAAE,CAAC,QAAQ,IAAI,OAAO,EAAE,CAAC,QAAQ,KAAK,QAAQ,EAAE;gBACpD,IAAI,EAAE,CAAC,QAAQ,KAAK,MAAM,EAAE;oBAC1B,MAAM,CAAC,mBAAmB,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC;iBAC3C;qBAAM;oBACL,MAAM,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;iBAC5F;aACF;QACH,CAAC,CAAC,CAAC;QAEL,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,mBAAmB,EAAE;YACjD,GAAG,EAAE;gBACH,IAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBAC9C,OAAO,YAAY,IAAI,IAAI,IAAI,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC;YACtG,CAAC;YACD,GAAG,EAAE,UAAU,KAAU;gBACvB,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;YAClC,CAAC;SACF,CAAC,CAAC;IACL,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import { filter } from 'rxjs/operators';\r\n\r\nimport { DecoratorOpts } from './interfaces/decorator-options';\r\nimport { LocalStorageService } from './services/ngx-localstorage.service';\r\nimport { StorageEventService } from './services/storage-event.service';\r\nimport { constructKey } from './utils';\r\nimport { DefaultSerializer } from './classes/default-serializer';\r\n\r\n/**\r\n * Provides a decoarator to bind a property directly to a storage value.\r\n * @param options configuration used for the decoarator\r\n */\r\nexport function ngxLocalStorage(options?: DecoratorOpts) {\r\n  return function (target: Object, propertyDescription: string) {\r\n\r\n    const key = !!options && !!options.key ? options.key : propertyDescription;\r\n    const prefix = !!options && !!options.prefix ? options.prefix : null;\r\n\r\n    const service: LocalStorageService = new LocalStorageService(new DefaultSerializer(),\r\n      {\r\n        prefix: prefix\r\n      });\r\n\r\n\r\n    const eventService: StorageEventService = new StorageEventService();\r\n    eventService.stream.pipe(\r\n      // TODO: filter should be more accurate\r\n      filter((ev: StorageEvent) => ev.key && ev.key.indexOf(constructKey(key, prefix)) >= 0)\r\n    )\r\n      .subscribe((ev: StorageEvent) => {\r\n        if (!!ev.newValue && typeof ev.newValue === 'string') {\r\n          if (ev.newValue !== 'null') {\r\n            target[propertyDescription] = ev.newValue;\r\n          } else {\r\n            target[propertyDescription] = !!options.nullTransformer ? options.nullTransformer() : null;\r\n          }\r\n        }\r\n      });\r\n\r\n    Object.defineProperty(target, propertyDescription, {\r\n      get: function () {\r\n        const storageValue = service.get(key, prefix);\r\n        return storageValue == null && !!options.nullTransformer ? options.nullTransformer() : storageValue;\r\n      },\r\n      set: function (value: any) {\r\n        service.set(key, value, prefix);\r\n      }\r\n    });\r\n  };\r\n}\r\n"]}