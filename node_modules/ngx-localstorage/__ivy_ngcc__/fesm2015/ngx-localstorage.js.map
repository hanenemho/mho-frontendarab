{"version":3,"file":"ngx-localstorage.js","sources":["../../../../libs/ngx-localstorage/src/lib/utils.ts","../../../../libs/ngx-localstorage/src/lib/services/promisable.service.ts","../../../../libs/ngx-localstorage/src/lib/tokens/storage-config.ts","../../../../libs/ngx-localstorage/src/lib/tokens/storage-serializer.ts","../../../../libs/ngx-localstorage/src/lib/services/ngx-localstorage.service.ts","../../../../libs/ngx-localstorage/src/lib/services/storage-event.service.ts","../../../../libs/ngx-localstorage/src/lib/directives/ngx-localstorage.directive.ts","../../../../libs/ngx-localstorage/src/lib/classes/default-serializer.ts","../../../../libs/ngx-localstorage/src/lib/ngx-localstorage.module.ts","../../../../libs/ngx-localstorage/src/lib/decorators.ts","../../../../libs/ngx-localstorage/src/index.ts","../../../../libs/ngx-localstorage/src/ngx-localstorage.ts"],"names":["observableFromEvent"],"mappings":"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","sourcesContent":["import { NgxLocalstorageConfiguration } from './interfaces/storage-configuration';\r\nimport { StorageSerializer } from './interfaces/storage-serializer';\r\n\r\n/**\r\n * Gets an objects property based on its path.\r\n * @param path Path to the property\r\n * @param object Object to access\r\n */\r\nexport const getProperty = (path: string[], object: any) =>\r\n  path.reduce((obj: any, p: any) => (!!obj) ? obj[p] : null, object);\r\n\r\n/**\r\n * Sets an objects property based on its path.\r\n * @param path Path to the property\r\n * @param value Value to set\r\n * @param object Object whose value to set\r\n * @param falsyTransformer optional transformer handling falsy values\r\n */\r\nexport const setProperty = (path: string[] | string, value: any, object: any, falsyTransformer?: () => any) => {\r\n  const lastKeyIndex = path.length - 1;\r\n  for (let i = 0; i < lastKeyIndex; ++i) {\r\n    const key = path[i];\r\n    if (!(key in object)) {\r\n      object[key] = {};\r\n    }\r\n    object = object[key];\r\n  }\r\n  object[path[lastKeyIndex]] = (!value || (typeof value === 'string' && value === 'false'))\r\n    && !!falsyTransformer ? falsyTransformer() : value;\r\n};\r\n\r\n/**\r\n * Constructs the storage key based on a prefix - if given - and the key itself\r\n */\r\nexport const constructKey = (key: string, prefix?: string, configuredPrefix?: string): string => {\r\n  const prefixToUse = prefix || configuredPrefix;\r\n  if (prefixToUse) {\r\n    return `${prefixToUse}_${key}`;\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * The librarys default config.\r\n */\r\nexport const defaultConfig: NgxLocalstorageConfiguration = {\r\n  allowNull: true\r\n};\r\n\r\n/**\r\n * StorageSerializer Guard\r\n */\r\nexport const isSerializer = (prefixOrSerializer: string | StorageSerializer): prefixOrSerializer is StorageSerializer => {\r\n  return !!prefixOrSerializer && (prefixOrSerializer as StorageSerializer).serialize !== undefined;\r\n}\r\n","import { NgxLocalstorageConfiguration } from '../interfaces/storage-configuration';\r\nimport { StorageSerializer } from '../interfaces/storage-serializer';\r\nimport { constructKey, isSerializer } from '../utils';\r\n\r\n/**\r\n * Provides a Promise based service to access the localstorage.\r\n */\r\nexport class PromisableService {\r\n\r\n  /**\r\n   * Creates a new instance\r\n   */\r\n  constructor(\r\n    private readonly configuration: NgxLocalstorageConfiguration,\r\n    private readonly defaultSerializer: StorageSerializer\r\n  ) { }\r\n\r\n  /**\r\n   * Gets the number of entries in the applications local storage.\r\n   */\r\n  public count(): Promise<number> {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        resolve(localStorage.length);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the nth (defined by the index parameter) key in the storage.\r\n   * The order of keys is user-agent defined, so you should not rely on it.\r\n   * @param index   An integer representing the number of the key you want to get the name of. This is a zero-based index.\r\n   */\r\n  public getKey(index: number): Promise<string | null> {\r\n    return new Promise<string | null>((resolve, reject) => {\r\n      if (index < 0) {\r\n        reject(new Error('index has to be 0 or greater'));\r\n      }\r\n      try {\r\n        resolve(localStorage.key(index));\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds the value with the given key or updates an existing entry.\r\n   * @param key     Key to store.\r\n   * @param value   Value to store.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public set(key: string, value: any, prefixOrSerializer?: string | StorageSerializer): Promise<boolean>;\r\n  public set(key: string, value: any, prefixOrSerializer: string | StorageSerializer): Promise<boolean>;\r\n  public set(key: string, value: any, prefixOrSerializer: string, serializer: StorageSerializer): Promise<boolean>;\r\n  public set(key: string, value: any, prefixOrSerializer?: string | StorageSerializer, serializer?: StorageSerializer): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n\r\n        const prefix = typeof prefixOrSerializer === 'string' ? prefixOrSerializer : undefined;\r\n        serializer = isSerializer(prefixOrSerializer)\r\n          ? (prefixOrSerializer as StorageSerializer)\r\n          : !!serializer\r\n            ? serializer\r\n            : this.defaultSerializer;\r\n\r\n        if (this.configuration.allowNull\r\n          || (!this.configuration.allowNull && value !== 'null' && value !== null && value !== undefined)) {\r\n          localStorage.setItem(constructKey(key, prefix, this.configuration.prefix), serializer.serialize(value));\r\n        } else {\r\n          return this.remove(key, prefix);\r\n        }\r\n        resolve(true);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Gets the entry specified by the given key or null.\r\n   * @param key     Key identifying the wanted entry.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public get(key: string, prefixOrSerializer?: string | StorageSerializer): Promise<any | null | undefined>;\r\n  public get(key: string, prefixOrSerializer: string | StorageSerializer): Promise<any | null | undefined>;\r\n  public get(key: string, prefixOrSerializer: string, serializer: StorageSerializer): Promise<any | null | undefined>;\r\n  public get(key: string, prefixOrSerializer?: string | StorageSerializer, serializer?: StorageSerializer): Promise<any | null | undefined> {\r\n    return new Promise<any | null | undefined>((resolve, reject) => {\r\n      try {\r\n\r\n        const prefix = typeof prefixOrSerializer === 'string' ? prefixOrSerializer : undefined;\r\n        serializer = isSerializer(prefixOrSerializer)\r\n          ? (prefixOrSerializer as StorageSerializer)\r\n          : !!serializer\r\n            ? serializer\r\n            : this.defaultSerializer;\r\n\r\n        resolve(serializer.deserialize(localStorage.getItem(constructKey(key, prefix, this.configuration.prefix))));\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Removes the entry specified by the given key.\r\n   * @param key     Key identifying the entry to remove.\r\n   * @param prefix  Optional prefix to overwrite the configured one.\r\n   */\r\n  public remove(key: string, prefix?: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        localStorage.removeItem(constructKey(key, prefix, this.configuration.prefix));\r\n        resolve(true);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clears all entries of the applications local storage.\r\n   */\r\n  public clear(): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        localStorage.clear();\r\n        resolve(true);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\nimport { NgxLocalstorageConfiguration } from '../interfaces/storage-configuration';\r\n\r\n/**\r\n * Provides an injection token for the service configuration.\r\n */\r\nexport const NGX_LOCAL_STORAGE_CONFIG = new InjectionToken<NgxLocalstorageConfiguration>('NgxLocalstorageConfiguration');","import { InjectionToken } from '@angular/core';\r\nimport { StorageSerializer } from '../interfaces/storage-serializer';\r\n\r\n/**\r\n * Provides an injection token for the services serializer.\r\n */\r\nexport const NGX_LOCAL_STORAGE_SERIALIZER = new InjectionToken<StorageSerializer>('StorageSerializer');","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { NgxLocalstorageConfiguration } from '../interfaces/storage-configuration';\r\nimport { PromisableService } from './promisable.service';\r\nimport { defaultConfig, constructKey, isSerializer } from '../utils';\r\nimport { NGX_LOCAL_STORAGE_CONFIG } from '../tokens/storage-config';\r\nimport { NGX_LOCAL_STORAGE_SERIALIZER } from '../tokens/storage-serializer';\r\nimport { StorageSerializer } from '../interfaces/storage-serializer';\r\n\r\n/**\r\n * Provides a service to access the localstorage.\r\n */\r\n@Injectable({ providedIn: 'root' })\r\nexport class LocalStorageService {\r\n\r\n  private readonly promisable: PromisableService;\r\n\r\n  /**\r\n   * Creates a new instance.\r\n   */\r\n  constructor(\r\n    @Inject(NGX_LOCAL_STORAGE_SERIALIZER) private readonly defaultSerializer: StorageSerializer,\r\n    @Inject(NGX_LOCAL_STORAGE_CONFIG) public readonly config?: NgxLocalstorageConfiguration\r\n  ) {\r\n    this.config = { ...defaultConfig, ...config };\r\n\r\n    this.promisable = new PromisableService(this.config, this.defaultSerializer);\r\n  }\r\n\r\n  /**\r\n   * Returns a service variant based on Promises.\r\n   */\r\n  public asPromisable(): PromisableService {\r\n    return this.promisable;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of entries in the applications local storage.\r\n   */\r\n  public count(): number | undefined {\r\n    try {\r\n      return localStorage.length;\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the nth (defined by the index parameter) key in the storage.\r\n   * The order of keys is user-agent defined, so you should not rely on it.\r\n   * @param index   An integer representing the number of the key you want to get the name of. This is a zero-based index.\r\n   */\r\n  public getKey(index: number): string | null | undefined {\r\n    if (index < 0) {\r\n      console.error(new Error('index has to be 0 or greater'));\r\n    }\r\n    try {\r\n      return localStorage.key(index);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the value with the given key or updates an existing entry.\r\n   * @param key     Key to store.\r\n   * @param value   Value to store.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   */\r\n  public set(key: string, value: any, prefixOrSerializer?: string | StorageSerializer): void;\r\n  /**\r\n   * Adds the value with the given key or updates an existing entry.\r\n   * @param key     Key to store.\r\n   * @param value   Value to store.\r\n   * @param prefixOrSerializer  prefix or serializer to overwrite the configured one.\r\n   */\r\n  public set(key: string, value: any, prefixOrSerializer: string | StorageSerializer): void;\r\n  /**\r\n   * Adds the value with the given key or updates an existing entry.\r\n   * @param key     Key to store.\r\n   * @param value   Value to store.\r\n   * @param prefix  Optional prefix to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public set(key: string, value: any, prefix: string, serializer: StorageSerializer): void;\r\n  /**\r\n   * Adds the value with the given key or updates an existing entry.\r\n   * @param key     Key to store.\r\n   * @param value   Value to store.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public set(key: string, value: any, prefixOrSerializer?: string | StorageSerializer, serializer?: StorageSerializer): void {\r\n\r\n    const prefix = typeof prefixOrSerializer === 'string' ? prefixOrSerializer : undefined;\r\n    serializer = isSerializer(prefixOrSerializer)\r\n      ? (prefixOrSerializer as StorageSerializer)\r\n      : !!serializer\r\n        ? serializer\r\n        : this.defaultSerializer;\r\n\r\n    if (\r\n      this.config.allowNull ||\r\n      (!this.config.allowNull &&\r\n        value !== 'null' &&\r\n        value !== null &&\r\n        value !== undefined)\r\n    ) {\r\n      localStorage.setItem(constructKey(key, prefix, this.config.prefix), serializer.serialize(value));\r\n    } else {\r\n      this.remove(key, constructKey(key, prefix, this.config.prefix));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the entry specified by the given key or null.\r\n   * @param key     Key identifying the wanted entry.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public get(key: string, prefixOrSerializer?: string | StorageSerializer): any | null | undefined;\r\n  /**\r\n   * Gets the entry specified by the given key or null.\r\n   * @param key     Key identifying the wanted entry.\r\n   * @param prefixOrSerializer  prefix or serializer to overwrite the configured one.\r\n   */\r\n  public get(key: string, prefixOrSerializer: string | StorageSerializer): any | null | undefined;\r\n  /**\r\n   * Gets the entry specified by the given key or null.\r\n   * @param key     Key identifying the wanted entry.\r\n   * @param prefix  prefix or serializer to overwrite the configured one.\r\n   * @param serializer serilizer.\r\n   */\r\n  public get(key: string, prefix: string, serializer: StorageSerializer): any | null | undefined;\r\n  /**\r\n   * Gets the entry specified by the given key or null.\r\n   * @param key     Key identifying the wanted entry.\r\n   * @param prefixOrSerializer  Optional prefix or serializer to overwrite the configured one.\r\n   * @param serializer  Optional serilizer.\r\n   */\r\n  public get(key: string, prefixOrSerializer?: string | StorageSerializer, serializer?: StorageSerializer): any | null | undefined {\r\n\r\n    const prefix = typeof prefixOrSerializer === 'string' ? prefixOrSerializer : undefined;\r\n    serializer = isSerializer(prefixOrSerializer)\r\n      ? (prefixOrSerializer as StorageSerializer)\r\n      : !!serializer\r\n        ? serializer\r\n        : this.defaultSerializer;\r\n\r\n    try {\r\n      return serializer.deserialize(localStorage.getItem(constructKey(key, prefix, this.config.prefix)));\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the entry specified by the given key.\r\n   * @param key     Key identifying the entry to remove.\r\n   * @param prefix  Optional prefix to overwrite the configured one.\r\n   */\r\n  public remove(key: string, prefix?: string): void {\r\n    try {\r\n      localStorage.removeItem(constructKey(key, prefix, this.config.prefix));\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears all entries of the applications local storage.\r\n   */\r\n  public clear(): void {\r\n    try {\r\n      localStorage.clear();\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n}\r\n","import { Injectable, OnDestroy } from '@angular/core';\r\nimport { fromEvent as observableFromEvent, BehaviorSubject, Observable, Subscription } from 'rxjs';\r\nimport { share, filter } from 'rxjs/operators';\r\n\r\n/**\r\n * Provides a service\r\n */\r\n@Injectable({ providedIn: 'root' })\r\nexport class StorageEventService implements OnDestroy {\r\n\r\n  private readonly _eventStream: BehaviorSubject<StorageEvent> = new BehaviorSubject<StorageEvent>(null);\r\n  private readonly subscription: Subscription;\r\n\r\n  /**\r\n   * Create e new instance.\r\n   */\r\n  constructor() {\r\n    this.subscription = observableFromEvent(window, 'storage')\r\n      .subscribe((ev: StorageEvent) => this._eventStream.next(ev));\r\n  }\r\n\r\n  /**\r\n   * Gets a stream of storage events.\r\n   */\r\n  public get stream(): Observable<StorageEvent> {\r\n    return this._eventStream\r\n      .asObservable().pipe(\r\n        filter(ev => !!ev),\r\n        share()\r\n      );\r\n  }\r\n\r\n  /**\r\n   * OnDestroy lifecycle hook. Clears the subscription.\r\n   */\r\n  public ngOnDestroy(): void {\r\n    if (!!this.subscription && !this.subscription.closed) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { AfterViewInit, Directive, ElementRef, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\r\nimport { fromEvent as observableFromEvent, Subscription } from 'rxjs';\r\nimport { debounceTime, filter } from 'rxjs/operators';\r\n\r\nimport { getProperty, setProperty } from '../utils';\r\nimport { LocalStorageService } from '../services/ngx-localstorage.service';\r\nimport { StorageEventService } from '../services/storage-event.service';\r\n\r\n/**\r\n * Provide a directive to directly interact with stored values.\r\n */\r\n@Directive({\r\n  selector: '[ngxLocalStorage]'\r\n})\r\nexport class LocalStorageDirective implements AfterViewInit, OnDestroy {\r\n\r\n  /**\r\n   * The key to use with localstorage.\r\n   */\r\n  @Input('ngxLocalStorage')\r\n  public lsKey: string;\r\n  /**\r\n   * The keys prefix to use.\r\n   */\r\n  @Input()\r\n  public lsPrefix: string;\r\n  /**\r\n   * The event to hook onto value changes.\r\n   */\r\n  @Input()\r\n  public lsEvent: string;\r\n  /**\r\n   * An optional debounce for storage write access after value changes.\r\n   */\r\n  @Input()\r\n  public lsDebounce = 0;\r\n  /**\r\n   * Flag if the bound elements value should be initialized from storage.\r\n   */\r\n  @Input()\r\n  public lsInitFromStorage = false;\r\n  /**\r\n   * An optional transformer to handle falsy values.\r\n   */\r\n  @Input()\r\n  public lsFalsyTransformer?: () => any;\r\n\r\n  /**\r\n   * Provides a path to access the bound elements value property.\r\n   */\r\n  @Input()\r\n  public set lsValuePath(path: any[] | string) {\r\n    if (path != null) {\r\n      this._valuePath = Array.isArray(path) ? path : path.split(',');\r\n    } else {\r\n      this._valuePath = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event which gets fired when a bound value got stored.\r\n   */\r\n  @Output()\r\n  public lsStoredValue = new EventEmitter<any>();\r\n\r\n  private _eventSubscription: Subscription;\r\n  private _valuePath: string[] = [];\r\n\r\n  /**\r\n   * Creates a new instance.\r\n   */\r\n  constructor(private readonly er: ElementRef,\r\n    private readonly lss: LocalStorageService,\r\n    private readonly es: StorageEventService) {\r\n\r\n    this.es.stream.pipe(\r\n      // TODO: filter should be more accurate\r\n      filter((ev: StorageEvent) => ev.key && ev.key.indexOf(this.lsKey) >= 0)\r\n    )\r\n      .subscribe((ev: StorageEvent) => {\r\n        setProperty(this._valuePath.length ? this._valuePath : ['value'], ev.newValue, this.er.nativeElement, this.lsFalsyTransformer);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * AfterViewInit lifecycle hook.\r\n   */\r\n  public ngAfterViewInit(): void {\r\n    this._initKey();\r\n    this._initFromStorage();\r\n    this._hookEvent();\r\n  }\r\n\r\n  /**\r\n   * Initalizes the from either the given value or the elements id or name property.\r\n   */\r\n  private _initKey(): void {\r\n    if (!this.lsKey) {\r\n      if (!this.er.nativeElement.id && !this.er.nativeElement.name) {\r\n        throw new Error('No key or element id or name supplied!');\r\n      }\r\n      this.lsKey = this.er.nativeElement.id || this.er.nativeElement.name;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hooks onto the elements given event to perform storage write on value changes.\r\n   */\r\n  private _hookEvent(): void {\r\n    if (this.lsEvent) {\r\n      this._eventSubscription = observableFromEvent(this.er.nativeElement, this.lsEvent).pipe(\r\n        debounceTime(this.lsDebounce))\r\n        .subscribe(() => {\r\n          this.lss.asPromisable().set(this.lsKey,\r\n            getProperty(this._valuePath.length ? this._valuePath : ['value'], this.er.nativeElement),\r\n            this.lsPrefix)\r\n            .then(() => {\r\n              this.lss.asPromisable().get(this.lsKey, this.lsPrefix)\r\n                .then((value: any) => {\r\n                  this.lsStoredValue.emit(value);\r\n                })\r\n                .catch((err: Error) => console.error(err));\r\n            })\r\n            .catch((err: Error) => console.error(err));\r\n        });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes the elements value from storage.\r\n   */\r\n  private _initFromStorage(): void {\r\n    if (this.lsInitFromStorage) {\r\n      this.lss.asPromisable().get(this.lsKey, this.lsPrefix)\r\n        .then((storedValue: any) => {\r\n          setProperty(this._valuePath.length ? this._valuePath : ['value'], storedValue, this.er.nativeElement, this.lsFalsyTransformer);\r\n        })\r\n        .catch((err: Error) => console.error(err));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from event observable.\r\n   */\r\n  public ngOnDestroy(): void {\r\n    if (this._eventSubscription && !this._eventSubscription.closed) {\r\n      this._eventSubscription.unsubscribe();\r\n    }\r\n  }\r\n}\r\n","import { StorageSerializer } from '../interfaces/storage-serializer';\r\nimport { Injectable } from \"@angular/core\";\r\n\r\n/**\r\n * Provides a default serialization mechanism while\r\n */\r\n@Injectable()\r\nexport class DefaultSerializer implements StorageSerializer {\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    public serialize(value: any): string {\r\n        return JSON.stringify(value);\r\n    }\r\n\r\n    /**\r\n     * @inheritdoc\r\n     */\r\n    public deserialize(storedValue: string): any {\r\n        return JSON.parse(storedValue);\r\n    }\r\n}","import { ModuleWithProviders, NgModule, Optional, SkipSelf } from '@angular/core';\r\n\r\nimport { NgxLocalstorageConfiguration } from './interfaces/storage-configuration';\r\nimport { LocalStorageDirective } from './directives/ngx-localstorage.directive';\r\nimport { NGX_LOCAL_STORAGE_CONFIG } from './tokens/storage-config';\r\nimport { DefaultSerializer } from './classes/default-serializer';\r\nimport { NGX_LOCAL_STORAGE_SERIALIZER } from './tokens/storage-serializer';\r\n\r\n/**\r\n * Provides the librarys module.\r\n */\r\n@NgModule({\r\n  imports: [\r\n  ],\r\n  declarations: [\r\n    LocalStorageDirective\r\n  ],\r\n  exports: [\r\n    LocalStorageDirective\r\n  ],\r\n  providers: [\r\n    {\r\n      provide: NGX_LOCAL_STORAGE_SERIALIZER,\r\n      useClass: DefaultSerializer\r\n    }\r\n  ]\r\n})\r\nexport class NgxLocalStorageModule {\r\n\r\n  /**\r\n   * Initializes the module for the root module with the given configuration.\r\n   */\r\n  public static forRoot(config?: NgxLocalstorageConfiguration): ModuleWithProviders<NgxLocalStorageModule> {\r\n    return {\r\n      ngModule: NgxLocalStorageModule,\r\n      providers: [\r\n        {\r\n          provide: NGX_LOCAL_STORAGE_CONFIG,\r\n          useValue: config\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance.\r\n   */\r\n  constructor(@Optional() @SkipSelf() parentModule: NgxLocalStorageModule) {\r\n    if (parentModule) {\r\n      throw new Error('NgxLocalStorageModule is already loaded. Import it in the AppModule only');\r\n    }\r\n  }\r\n}\r\n","import { filter } from 'rxjs/operators';\r\n\r\nimport { DecoratorOpts } from './interfaces/decorator-options';\r\nimport { LocalStorageService } from './services/ngx-localstorage.service';\r\nimport { StorageEventService } from './services/storage-event.service';\r\nimport { constructKey } from './utils';\r\nimport { DefaultSerializer } from './classes/default-serializer';\r\n\r\n/**\r\n * Provides a decoarator to bind a property directly to a storage value.\r\n * @param options configuration used for the decoarator\r\n */\r\nexport function ngxLocalStorage(options?: DecoratorOpts) {\r\n  return function (target: Object, propertyDescription: string) {\r\n\r\n    const key = !!options && !!options.key ? options.key : propertyDescription;\r\n    const prefix = !!options && !!options.prefix ? options.prefix : null;\r\n\r\n    const service: LocalStorageService = new LocalStorageService(new DefaultSerializer(),\r\n      {\r\n        prefix: prefix\r\n      });\r\n\r\n\r\n    const eventService: StorageEventService = new StorageEventService();\r\n    eventService.stream.pipe(\r\n      // TODO: filter should be more accurate\r\n      filter((ev: StorageEvent) => ev.key && ev.key.indexOf(constructKey(key, prefix)) >= 0)\r\n    )\r\n      .subscribe((ev: StorageEvent) => {\r\n        if (!!ev.newValue && typeof ev.newValue === 'string') {\r\n          if (ev.newValue !== 'null') {\r\n            target[propertyDescription] = ev.newValue;\r\n          } else {\r\n            target[propertyDescription] = !!options.nullTransformer ? options.nullTransformer() : null;\r\n          }\r\n        }\r\n      });\r\n\r\n    Object.defineProperty(target, propertyDescription, {\r\n      get: function () {\r\n        const storageValue = service.get(key, prefix);\r\n        return storageValue == null && !!options.nullTransformer ? options.nullTransformer() : storageValue;\r\n      },\r\n      set: function (value: any) {\r\n        service.set(key, value, prefix);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/*\r\n * Public API Surface of ngx-localstorage\r\n */\r\n// module\r\nexport * from './lib/ngx-localstorage.module';\r\n// services\r\nexport * from './lib/services/ngx-localstorage.service';\r\nexport * from './lib/services/storage-event.service';\r\n// directives\r\nexport * from './lib/directives/ngx-localstorage.directive';\r\n// decorator\r\nexport * from './lib/decorators';\r\n// interfaces\r\nexport * from './lib/interfaces/decorator-options';\r\nexport * from './lib/interfaces/storage-configuration';\r\nexport * from './lib/interfaces/storage-serializer';\r\n// tokens\r\nexport * from './lib/tokens/storage-config';\r\nexport * from './lib/tokens/storage-serializer';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {DefaultSerializer as ɵa} from './lib/classes/default-serializer';"]}